# The "Things"

## Field devices for IIoT (Industrial IoT)

At the edge of a IoT system we can find:

1) A Sensor Node (or mote): it is a device that sense external phenomena, process information, store those information and communicate with other motes or devices. So a Sensor Node can only produce information.

2) Actuator: an actuator receives input signal from control devices, it processes and store information and then can act on the industrial process. So an Actuator can act with the environment.

### Mote Architecture

<img src="file:///android_asset/iot_/img/img1.png" >

**(Ideal) ADC**:

An ADC (analog to digital converter) has in input a time-continuous and amplitude-continuos signal and it ouputs a string of bits. It is composed by a sampler and a quantizer.

**Sampling**: The sampler reads the time-continuos signal at given points in time. If the sampling frequency is at least twice the bandwidth of the signal (Nyquist Rate) then the initial signal can be lossless reconstructed from its samples.

**Quantization**: the quantizer discretizes the continuos amplitude of the sampled signal (so it is done after the sampling). The number of discrete levels for the amplitude of the sampled signal is called *Resolution*. The higher the levels the lower the quantization error (there is always a loss in the quantization phase).

### IoT Hardware Breakdown

Iot Harware offert is vast, fragmented and heterogeneous. End-device/sensors become capable to run Operating System. This is important because without an OS an application program directly controls the hardware so there is a high dependence on the hardware and low reusability of the application program (since it is specific for a given harware). With the use a real-time OS the application program controls the hardware via the real-time OS so there is low dependence on the harware and a high reusability of the application program; the use of a real-time OS however worsen the performance. 

## What if Sensors/Actuators are Wireless?

No cables means no power and no wired connectivity. **Energy efficiency becomes a MUST**. Sensor node *lifetime* depends on *battery* lifetime.

Recharching or battery replacement may be immaterial or too expensive, so we can try to use a secondary battery which is rechargeable with some form of energy harvesting (i.e. solar power) but not always feasible.

### Power Consumption

Who consumes more?

The communication part is what consumes more. The power consumption of the sensing peripherals (sensors) and the CPU is way lower than the power consumption during transmission, receiving or in idle state (is on but is not trasmitting neither receiving). Only in sleep mode the power consumption of the communication part is very low. So the *General Design Guideline* is to switch off the communication part to save battery.

**The "idle Listening" Problem**: the power consumption of communications devices is roughly the same wheter the radio is transmitting, receiving or simply ON. Radio must be ON (listening) in order to receive anything so the total energy consumption is dominated by *idle listening*.

### Duty cycle model

To save battery the radio transceiver (communication peripherals) is sleeping (OFF). Then it wakes up (WakeUP phase) and is operative for a certain amount of time.

<img src="file:///android_asset/iot_/img/img2.png" >

The WakeUp part is wasted time: is the time for the radio transceiver to start operating. In the WakeUp part we are consuming energy without doing any job. The Sleep part lasts much longer w.r.t. the active part: usually $$f_{active}=1 $$%. ($$f_{active}$$ is the fraction of time in which our radio transceiver is awake).

The average power, so the average consumed power in 1 duty cycle is:
$$
P_{ave}=(1-f_{active})*P_{sleep}+f_{active}*P_{active}
$$
that can also be written as
$$
P_{ave}=f_{sleep}*P_{sleep}+f_{wakeUp}*P_{wakeUp}+f_{work}*P_{work}
$$
The lifetime, so how much time the sensor node can operate is
$$
\text {Lifetime}= \text{EnergyStore}/(P_{ave}-P_{gen}) 
$$
where EnergyStore is the capacity of our battery and $$P_{gen}$$ is the power that can be generated by harvest energy if present.

**Energy Consumption in trasmission**:
$$
E_{tx} = P_{tx}(T_{wu}+T_{tx})+P_0T_{tx}
$$
$$P_{tx}(T_{wu}+T_{tx})$$ is the energy consumed to power the circuit for all the time needed: $$P_{tx}$$ is the power consumed by the transmitter, $$T_{wu}$$ is the start-up time for transmitter, $$T_{tx}$$ is the time to transmit a packet and $$P_0$$ is the output power of the transmitter.

**Energy consumption in reception**:
$$
E_{rx} = P_{rx}(T_{wu}+T_{rx})
$$
where $$P_{rx}$$ is the power consumed by the receiver and $$T_{rx}$$ is the time to receive a packet.

The time to trasmit or receive a packet is given by the lenght of the packet  L[bits] divided by the rate R [bits/s]. The higher L the lower the impact of the wake-up time: if L is higher the energy consumed per bit is lower.

**On the emitted power**

The emitted power impacts on the distance between transmitter and receiver and is often a tunable parameter. Good practice is to set it to the lowest value which allows for "good reception" But what is a good reception?

The quality of the reception process can be measured in terms of:

- Bit Error Rate (BER): fraction of bit not correctly received (1 for 0 or viceversa)
- Packet Error Rate (PER): fraction of packet not correctly received
- PER/BER relation (packet of lenght l, indipendent errors):

$$
\text{probability a packet is wrong : } PER = 1-(1-BER)^l
$$

where (1-BER) is the probability a paket is correctly received.

BER (and PER in turn) depends on the “level of noise” in the TX/RX channel, which, in turn, depends on the transmitted/received power
$$
\text {Signal to Interference plus Noise ratio : } SINR=10log_{10}\bigg(\frac{P_{recv}}{N_0+\sum_{i=1}^N I_i} \bigg) 
$$
where $$P_{recv}$$ is the power received at the receiver, $$N_0$$ is the background noise and $$\sum I_i$$ is the contribution of the interferences.

BER can be computed once given the specific TX/RX channel (modulation) and the specific SINR.

**Receiver Sensitivity**: each receiver is characterized by a sensitivity parameter which is the minimum input signal power needed at receiver input to provide adequate SNR at receiver output to do data demodulation

**Memory power consumption**: power for RAM is almost negligible, the crucial part is FLASH memory.